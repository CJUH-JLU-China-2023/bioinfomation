#加载包
library(pROC)
getwd()
#读取miRNA表达数据
miRNA <- read.csv("mirna_data.csv",sep="\t", header = TRUE)
mirna_data <- t(miRNA)
View(mirna_data)
library(tibble)
# 定义两个简单的函数
up=function(df){
rownames(df)[df$change=="UP"]
}
down=function(df){
rownames(df)[df$change=="DOWN"]
}
GSE = read.table('GSE59247.top.table-1.tsv',sep="\t",header=T,check.names=F)
rownames(GSE) <- GSE[,1]
GSE <- GSE[,-1]
logFC_cutoff=1
padj=0.05
# 添加显著性标签
GSE$change <- factor(ifelse(GSE$PValue < padj & abs(GSE$logFC) > logFC_cutoff,
ifelse(GSE$logFC > logFC_cutoff ,'UP','DOWN'),
'NOT'))
TCGA = read.table('miRNA-TCGA.csv',sep="\t",header=T,check.names=F)
# 查看上调及下调基因数目
daframe <- data.frame(gse=as.integer(table(GSE$change)),
tcg=as.integer(table(TCGA$change)),
row.names = c('DOWN','NOT','UP'))
# 韦恩图
# 上调三维维恩图
#install.packages('ggVennDiagram')
library(ggVennDiagram)
library(ggplot2)
mydata<-list(gse=up(GSE),tcga=up(TCGA))
ggVennDiagram(mydata)
# 换个配色
#install.packages('paletteer')
library(paletteer)
View(palettes_c_names)
ggVennDiagram(mydata) +
scale_fill_paletteer_c('ggthemes::Orange-Blue Light Diverging', direction = 1)
ggVennDiagram(mydata,
category.names = c("GSE59247","TCGA-BRCA"),
set_color="black",
set_size=5,
label = "both",
label_percent_digit=0,
label_color="black",
label_size=5,
label_alpha = 0)+
scale_fill_paletteer_c('ggthemes::Orange-Blue Light Diverging', direction = 1)
up(GSE)[which(up(GSE) %in% up(TCGA))]
up(GSE)
View(GSE)
# 查看上调及下调基因数目
daframe <- data.frame(gse=as.integer(table(GSE$change)),
tcg=as.integer(table(TCGA$change)),
row.names = c('DOWN','NOT','UP'))
View(daframe)
library(ggplot2)
rm(list = ls())
# 添加点标签
library(ggrepel)
logFC_cutoff=1
padj=0.05
DEG = read.table('GSE59247.top.table-1.tsv',sep="\t",header=T,check.names=F)
rownames(DEG) <- DEG[,1]
DEG <- DEG[,-1]
# 添加显著性标签
DEG$change <- factor(ifelse(DEG$PValue < padj & abs(DEG$logFC) > logFC_cutoff,
ifelse(DEG$logFC > logFC_cutoff ,'UP','DOWN'),
'NOT'))
significant = subset(DEG[c('hsa-miR-21-5p','hsa-miR-96-5p','hsa-miR-183-5p','hsa-miR-592','hsa-miR-3923','hsa-miR-885-5p','hsa-miR-142-5p','hsa-miR-339-3p','hsa-miR-184'),])
g <- ggplot(DEG,aes(logFC,-log10(as.numeric(PValue)),color=change))
g + geom_point()
g + geom_point(size = 0.5) +
labs(x = 'log2 Fold Change', y = '-log10 adjust p-value', title = 'volcano_plot') +
theme(plot.title = element_text(hjust = 0.5, size = 20,color = 'firebrick'),
panel.grid = element_blank(),
panel.background = element_rect(color = 'black', fill = 'transparent'),
legend.key = element_rect(fill = 'transparent')) +
geom_vline(xintercept = c(-logFC_cutoff, logFC_cutoff), lty = 2, color = 'black') +  #添加阈值线
geom_hline(yintercept = -log10(padj), lty = 2, color = 'black')
g + geom_point(size = 1) +
labs(x = 'log2 Fold Change', y = '-log10 p-value') +
theme(plot.title = element_text(hjust = 0.5, size = 15,color = 'firebrick'),
panel.grid = element_blank(),
panel.background = element_rect(color = 'black', fill = 'transparent'),
legend.key = element_rect(fill = 'transparent')) +
scale_color_manual(values =c('UP' = 'red', 'DOWN' = 'blue', 'NOT' = 'gray'))+
geom_vline(xintercept = c(-logFC_cutoff, logFC_cutoff), lty = 2, color = 'black') +  #添加阈值线
geom_hline(yintercept = -log10(padj), lty = 2, color = 'black') +
geom_text_repel(data = significant,aes(label = rownames(significant)),
max.overlaps = 10000, # 最大覆盖率，当点很多时，有些标记会被覆盖，调大该值则不被覆盖
size=3,col = 'black',box.padding = unit(2, 'lines'),segment.color = 'black', show.legend = FALSE)
ggsave('volcano_plot_GSE59247.svg',height = 20,width = 30,units = 'cm')
ggsave('volcano_plot_GSE59247.png',height = 20,width = 30,units = 'cm')
install.packages("svglite")
ggsave('volcano_plot_GSE59247.svg',height = 20,width = 30,units = 'cm')
#清空环境变量
rm(list = ls())
#加载包
library(pROC)
getwd()
#读取miRNA表达数据
miRNA <- read.csv("mirna_data.csv",sep="\t", header = TRUE)
mirna_data <- t(miRNA)
# 获取行名
row_names <- row.names(mirna_data)
# 根据行名的第14-15位是否小于10添加标签
labels <- ifelse(as.numeric(substr(row_names, 14, 15)) < 10, "Positive", "Negative")
# 选择需要绘制ROC曲线的miRNA
mirna_name_21 <- "hsa-miR-21-5p"
mirna_name_183 <- "hsa-miR-183-5p"
mirna_name_96 <- "hsa-miR-96-5p"
mirna_name_592 <- "hsa-miR-592"
mirna_name_3923 <- "hsa-miR-3923"
mirna_name_885 <- "hsa-miR-885-5p"
mirna_name_184 <- "hsa-miR-184"
mirna_name_339 <- "hsa-miR-339-3p"
mirna_name_142 <- "hsa-miR-142-5p"
# 获取表达数据和阳性/阴性标签数据
mirna_expression_21 <- mirna_data[, mirna_name_21]
mirna_expression_183 <- mirna_data[, mirna_name_183]
mirna_expression_96 <- mirna_data[, mirna_name_96]
mirna_expression_592 <- mirna_data[, mirna_name_592]
mirna_expression_3923 <- mirna_data[, mirna_name_3923]
mirna_expression_885 <- mirna_data[, mirna_name_885]
mirna_expression_184 <- mirna_data[, mirna_name_184]
mirna_expression_339 <- mirna_data[, mirna_name_339]
mirna_expression_142 <- mirna_data[, mirna_name_142]
#创建ROC对象
roc_data_21 <- roc(labels, mirna_expression_21)
roc_data_183 <- roc(labels, mirna_expression_183)
roc_data_96 <- roc(labels, mirna_expression_96)
roc_data_592 <- roc(labels, mirna_expression_592)
roc_data_3923 <- roc(labels, mirna_expression_3923)
roc_data_885 <- roc(labels, mirna_expression_885)
roc_data_184 <- roc(labels, mirna_expression_184)
roc_data_339 <- roc(labels, mirna_expression_339)
roc_data_142 <- roc(labels, mirna_expression_142)
svg('roc_miR.svg')
plot(roc_data_21,legacy.axes = TRUE,
col="red",identity.col="skyblue2",main = paste0("ROC curve for TCGA-BRCA"))
plot(roc_data_183,add=T,legacy.axes = TRUE,
col="green",identity.col="skyblue2")
plot(roc_data_96,add=T,legacy.axes = TRUE,
col="blue",identity.col="skyblue2")
plot(roc_data_592,add=T,legacy.axes = TRUE,
col="orange",identity.col="skyblue2")
plot(roc_data_3923,add=T,legacy.axes = TRUE,
col="gray",identity.col="skyblue2")
plot(roc_data_885,add=T,legacy.axes = TRUE,
col="cyan",identity.col="skyblue2")
plot(roc_data_184,add=T,legacy.axes = TRUE,
col="yellow",identity.col="skyblue2")
plot(roc_data_339,add=T,legacy.axes = TRUE,
col="brown",identity.col="skyblue2")
plot(roc_data_142,add=T,legacy.axes = TRUE,
col="black",identity.col="skyblue2")
legend("bottomright",
legend = c("miR-21-5p","miR-183-5p","miR-96-5p","miR-592","miR-3923","miR-885-5p","miR-184","miR-339-3p","miR-142-5p"),
col = c("red","green","blue","orange","gray","cyan","yellow","brown","black"),lty = 1)
dev.off()
# 导入数据
rt <- read.table("TCGA-BRCA_miRNA_matrue_RPM.xls",sep="\t",header=T,check.names=F)
load("D:/iGEM/生信分析/R语言实现TCGA数据分析-代码挂网/07 miRNA差异表达/TCGA-BRCA_miRNA_matrue_RPM.RData")
View(mirna_data)
# 导入数据
rt <- read.table("TCGA-BRCA_miRNA_matrue_RPM.xls",sep="\t",header=T,check.names=F)
# 导入数据
rt <- read.table("TCGA-BRCA_miRNA_matrue_RPM.xls",sep="\t",header=T,check.names=F)
# 数据处理
rownames(rt) <- rt[,2]
rt <- rt[,-1]
rt <- rt[,-1]
dim(rt)
write.table(rt, file="rt.xls", sep="\t", quote=F, col.names=T)
rt=rt[rowMeans(rt)>0,]
# 用substr函数在TCGA数据中提取样本信息
group <- factor(ifelse(as.integer(substr(colnames(rt),14,15))<10,'tumor','normal'),
levels = c('normal','tumor'))
table(group)
View(rt)
rt=rt[colMeans(rt)>0,]
View(rt)
# 导入数据
rt <- read.table("TCGA-BRCA_miRNA_matrue_RPM.xls",sep="\t",header=T,check.names=F)
# 数据处理
rownames(rt) <- rt[,2]
rt <- rt[,-1]
rt <- rt[,-1]
dim(rt)
rt=rt[colMeans(rt)>0,]
write.table(rt, file="rt.xls", sep="\t", quote=F, col.names=T)
# 用substr函数在TCGA数据中提取样本信息
group <- factor(ifelse(as.integer(substr(colnames(rt),14,15))<10,'tumor','normal'),
levels = c('normal','tumor'))
table(group)
View(rt)
View(mirna_data)
View(rt)
